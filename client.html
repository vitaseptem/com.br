<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Vita Points ‚Äì Estilo que Ganha | Vita Septem</title>
  <meta name="description" content="Programa de fidelidade Vita Points da Vita Septem. Cadastre-se, entre e acompanhe seus pontos e recompensas."/>
  <meta name="theme-color" content="#880c21"/>
  <meta property="og:title" content="Vita Points ‚Äì Estilo que Ganha"/>
  <meta property="og:description" content="Cadastre-se e acompanhe seus pontos de fidelidade da Vita Septem."/>
  <meta property="og:type" content="website"/>
  <meta property="og:locale" content="pt_BR"/>
  <link rel="icon" type="image/x-icon" href="icon.ico"/>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --wine:#880c21; --wine-600:#a11837; --black:#0e0e0f; --gray-900:#17171a;
      --gray-800:#1a1a1e; --gray-700:#232327; --gray-500:#6b6b72; --white:#ffffff;
      --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35);
      --ok:#21d07a; --warn:#e2b93b; --danger:#ff5d5d;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--white);
      background:linear-gradient(180deg,var(--black),var(--gray-900) 35%, #0b0b0c);
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    a{color:inherit; text-decoration:none}
    .container{max-width:1200px; margin:0 auto; padding:0 20px}

    /* Header (logo grande central) */
    header{
      position:sticky; top:0; z-index:50; backdrop-filter:saturate(140%) blur(8px);
      background:rgba(13,13,15,.7); border-bottom:1px solid rgba(255,255,255,.06)
    }
    .nav{display:flex; align-items:center; justify-content:center; padding:20px 0;}
    .brand{display:flex; gap:12px; align-items:center; justify-content:center;}
    .brand img{height:150px; width:auto; object-fit:contain}
    .brand .title{display:none}

    /* Hero */
    .hero{position:relative; overflow:hidden; isolation:isolate;}
    .hero::before{
      content:""; position:absolute; inset:-20%; background:
        radial-gradient(80% 60% at 70% 20%, rgba(136,12,33,.35), transparent 60%),
        radial-gradient(60% 40% at 10% 10%, rgba(255,255,255,.08), transparent 60%);
      z-index:-1; filter:blur(10px)
    }
    .hero-grid{display:grid; grid-template-columns:1.1fr .9fr; gap:36px; align-items:center; padding:68px 0}
    .kicker{color:#e9e9ea; letter-spacing:.14em; text-transform:uppercase; font-size:.82rem}
    h1{
      margin:.35rem 0 1rem; font-family:"Playfair Display",serif; font-weight:700;
      font-size:clamp(2.1rem, 3.2vw + 1rem, 3.6rem); line-height:1.05;
    }
    .lead{color:#d9d9dd; font-size:1.05rem; max-width:48ch}
    .actions{display:flex; gap:12px; margin-top:22px; flex-wrap:wrap}
    .btn{
      display:inline-flex; align-items:center; gap:10px; padding:12px 18px; border-radius:14px; font-weight:600;
      background:var(--wine); border:1px solid rgba(255,255,255,.1); box-shadow:var(--shadow);
      transition:transform .15s ease, background .2s ease, box-shadow .2s ease; cursor:pointer;
    }
    .btn:hover{background:var(--wine-600); transform:translateY(-1px)}
    .btn.secondary{background:transparent; border-color:rgba(255,255,255,.18)}
    .hero-visual{
      background:linear-gradient(180deg,#141416, #0d0d0f);
      border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); min-height:360px;
      display:grid; place-items:center; position:relative; overflow:hidden;
    }
    .tag{position:absolute; top:14px; right:14px; padding:6px 10px; border-radius:999px;
      background:rgba(136,12,33,.18); border:1px solid rgba(136,12,33,.5); font-size:.78rem}

    section{padding:56px 0}
    .section-title{font-family:"Playfair Display",serif; font-weight:700; font-size:2rem; margin:0 0 14px}
    .muted{color:#cfcfd6; margin:0 0 26px}

    /* Cart√µes e m√≥dulos */
    .row{display:grid; grid-template-columns:repeat(12,1fr); gap:18px}
    .card{grid-column:span 12; background:linear-gradient(180deg,#141416,#101013); border:1px solid rgba(255,255,255,.08); border-radius:16px; overflow:hidden}
    .card .p{padding:18px}
    .grid-2{display:grid; grid-template-columns:1fr 1fr; gap:18px}
    .badge{background:rgba(136,12,33,.22); border:1px solid rgba(136,12,33,.55); padding:4px 10px; border-radius:999px; font-size:.78rem}

    /* Form */
    .field{display:flex; flex-direction:column; gap:6px}
    .field label{font-size:.9rem; color:#e9e9ea}
    .input, select{width:100%; padding:12px 14px; border-radius:12px; background:#121214; color:#fff; border:1px solid rgba(255,255,255,.12); outline:none}
    .input:focus, select:focus{border-color:rgba(255,255,255,.28)}
    .split{display:grid; grid-template-columns:1fr 1fr; gap:12px}
    .helper{font-size:.85rem; color:#bdbdc6}

    /* Tabela de recompensas */
    table{width:100%; border-collapse:separate; border-spacing:0; overflow:hidden; border-radius:14px; border:1px solid rgba(255,255,255,.08)}
    th,td{padding:12px 14px; border-bottom:1px solid rgba(255,255,255,.06); text-align:left}
    th{background:#161618; font-weight:600}
    tr:last-child td{border-bottom:none}
    .ok{color:var(--ok)} .warn{color:var(--warn)} .danger{color:var(--danger)}

    /* Barra de progresso */
    .progress{height:12px; width:100%; background:#19191c; border:1px solid rgba(255,255,255,.09); border-radius:999px; overflow:hidden}
    .progress > span{display:block; height:100%; background:linear-gradient(90deg, #a11837, #880c21); width:0%}

    /* WhatsApp FAB */
    .fab{position:fixed; right:18px; bottom:18px; background:#25D366; color:#000; font-weight:700; padding:12px 14px; border-radius:999px; box-shadow:var(--shadow); z-index:60}

    /* Responsivo */
    @media (max-width:980px){ .hero-grid{grid-template-columns:1fr; padding:44px 0} .grid-2{grid-template-columns:1fr} .brand img{height:96px} }
    @media (max-width:640px){ .brand img{height:56px} }
  </style>
</head>
<body>
  <!-- Bot√£o WhatsApp -->
  <a href="https://wa.me/5599981543912?text=Tenho%20d%C3%BAvidas%20sobre%20o%20Vita%20Points" class="fab" aria-label="Falar no WhatsApp">WhatsApp</a>

  <!-- Header -->
  <header>
    <div class="container nav">
      <div class="brand" aria-label="Vita Septem">
        <img src="icon2.png" alt="Logo Vita Septem"/>
        <div class="title"></div>
      </div>
    </div>
  </header>

  <main>
    <!-- HERO -->
    <section class="hero">
      <div class="container hero-grid">
        <div>
          <div class="kicker">Vita Septem ‚Ä¢ Fidelidade</div>
          <h1>Vita Points ‚Äì Estilo que Ganha</h1>
          <p class="lead">Junte pontos em cada compra e troque por recompensas. Clientes veem o saldo; a loja credita os pontos. N√∫meros de cart√£o de <b>01 at√© 32.767</b>.</p>
          <div class="actions">
            <a href="#acesso" class="btn">Acessar meus pontos</a>
            <a href="#recompensas" class="btn secondary">Ver recompensas</a>
          </div>
        </div>
        <div class="hero-visual" role="img" aria-label="Cart√£o Vita Points">
          <span class="tag">Programa Ativo</span>
          <img src="https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?q=80&w=1400&auto=format&fit=crop" alt="" style="width:100%; height:100%; object-fit:cover;">
        </div>
      </div>
    </section>

    <!-- REGRAS + RECOMPENSAS -->
    <section id="recompensas">
      <div class="container row">
        <article class="card" style="grid-column:span 12">
          <div class="p grid-2">
            <div>
              <h2 class="section-title">Como funciona</h2>
              <p class="muted">1 ponto a cada R$ 10 em compras. Pontos v√°lidos por 12 meses. Resgates apenas na loja f√≠sica. Clientes VIP recebem <b>pontos em dobro no m√™s do anivers√°rio</b>.</p>
              <div class="helper">O cart√£o √© pessoal e intransfer√≠vel ‚Ä¢ N√£o somar pontos de clientes diferentes ‚Ä¢ Promo√ß√µes acumulam pontos normalmente</div>
            </div>
            <div>
              <h3 class="section-title" style="font-size:1.4rem">Recompensas</h3>
              <table>
                <thead><tr><th>Pontos</th><th>Recompensa</th></tr></thead>
                <tbody>
                  <tr><td>50</td><td>10% OFF na pr√≥xima compra</td></tr>
                  <tr><td>100</td><td>Camiseta b√°sica Vita Septem</td></tr>
                  <tr><td>150</td><td>Polo ou cal√ßa social com 20% OFF</td></tr>
                  <tr><td>200</td><td>Camisa social premium</td></tr>
                  <tr><td>300</td><td>Vale-compras de R$ 200,00</td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </article>
      </div>
    </section>

    <!-- ACESSO (LOGIN/CADASTRO) -->
    <section id="acesso">
      <div class="container row">
        <article class="card" style="grid-column:span 12">
          <div class="p grid-2">
            <!-- Login -->
            <div>
              <h2 class="section-title">Entrar</h2>
              <form id="formLogin" class="grid-2" autocomplete="on" novalidate>
                <div class="field" style="grid-column:span 2">
                  <label for="loginEmail">E-mail</label>
                  <input id="loginEmail" type="email" class="input" placeholder="seu@email.com" required>
                </div>
                <div class="field" style="grid-column:span 2">
                  <label for="loginPass">Senha</label>
                  <input id="loginPass" type="password" class="input" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required>
                </div>
                <button class="btn" type="submit" style="grid-column:span 2">Entrar</button>
                <div id="loginMsg" class="helper" style="grid-column:span 2"></div>
              </form>
              <div class="helper" style="margin-top:8px">N√£o tem conta? Use o cadastro ao lado. Se j√° tiver n√∫mero de cart√£o, mantenha-o; se n√£o, escolha um livre entre 01 e 32.767.</div>
            </div>

            <!-- Cadastro -->
            <div>
              <h2 class="section-title">Cadastro</h2>
              <form id="formCadastro" class="grid-2" autocomplete="on" novalidate>
                <div class="field" style="grid-column:span 2">
                  <label for="cadNome">Nome completo</label>
                  <input id="cadNome" class="input" placeholder="Seu nome" required>
                </div>
                <div class="split" style="grid-column:span 2">
                  <div class="field">
                    <label for="cadTelefone">Telefone (WhatsApp)</label>
                    <input id="cadTelefone" class="input" placeholder="(98) 9 XXXX-XXXX" inputmode="tel">
                  </div>
                  <div class="field">
                    <label for="cadMemberNo">N¬∫ do cart√£o (01‚Äì32.767)</label>
                    <input id="cadMemberNo" class="input" placeholder="00001" inputmode="numeric" pattern="[0-9]*" maxlength="5" required>
                  </div>
                </div>
                <div class="split" style="grid-column:span 2">
                  <div class="field">
                    <label for="cadEmail">E-mail</label>
                    <input id="cadEmail" type="email" class="input" placeholder="seu@email.com" required>
                  </div>
                  <div class="field">
                    <label for="cadPass">Senha</label>
                    <input id="cadPass" type="password" class="input" placeholder="Crie uma senha" required>
                  </div>
                </div>
                <button class="btn" type="submit" style="grid-column:span 2">Criar conta</button>
                <div id="cadMsg" class="helper" style="grid-column:span 2"></div>
              </form>
              <div class="helper">Se o n√∫mero escolhido j√° estiver em uso, o sistema avisa para escolher outro. (A loja autoriza 32.767 cart√µes.)</div>
            </div>
          </div>
        </article>
      </div>
    </section>

    <!-- PAINEL DO CLIENTE (mostra ap√≥s login) -->
    <section id="painel" style="display:none">
      <div class="container row">
        <article class="card" style="grid-column:span 12">
          <div class="p">
            <div style="display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap">
              <h2 class="section-title" style="margin:0">Meu Cart√£o Vita Points</h2>
              <button id="btnSair" class="btn secondary">Sair</button>
            </div>

            <div class="grid-2" style="margin-top:14px">
              <div style="display:grid; gap:10px">
                <div class="helper">Bem-vindo(a), <b id="uNome">‚Äî</b></div>
                <div style="display:flex; gap:10px; align-items:center; flex-wrap:wrap">
                  <span class="badge">N¬∫ do cart√£o: <b id="uCard">‚Äî</b></span>
                  <span class="badge">Status: <b id="uStatus">Cliente</b></span>
                </div>
                <div>
                  <div style="font-weight:600; margin-bottom:6px">Pontos</div>
                  <div style="display:flex; align-items:center; gap:10px; margin-bottom:8px">
                    <div class="progress" style="flex:1"><span id="bar"></span></div>
                    <div style="min-width:64px; text-align:right"><b id="uPontos">0</b></div>
                  </div>
                  <div class="helper" id="uMensagem">‚Äî</div>
                </div>
              </div>

              <div>
                <div class="helper" style="margin-bottom:8px">Recompensas</div>
                <table>
                  <thead><tr><th>Pontos</th><th>Recompensa</th><th>Situa√ß√£o</th></tr></thead>
                  <tbody id="tRewards"></tbody>
                </table>
                <div class="helper" style="margin-top:8px">Resgate √© feito somente na loja f√≠sica. Leve seu n√∫mero do cart√£o.</div>
              </div>
            </div>

            <div style="margin-top:18px; display:flex; gap:10px; align-items:center; flex-wrap:wrap">
              <button id="btnCardQR" class="btn secondary">Mostrar QR do meu cart√£o</button>
              <canvas id="qrCanvas" style="display:none; background:#fff; border-radius:12px; padding:8px"></canvas>
            </div>
          </div>
        </article>
      </div>
    </section>
  </main>

  <!-- Rodap√© -->
  <footer>
    <div class="container" style="display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap; padding:28px 0 60px; border-top:1px solid rgba(255,255,255,.08); color:#cfcfd6">
      <div class="brand-small" style="display:flex; gap:10px; align-items:center">
        <img src="icon.png" alt="" width="28" height="28" aria-hidden="true">
        <span>¬© <span id="year"></span> Vita Septem ‚Äì Men‚Äôs Fashion</span>
      </div>
      <small>Vita Points ‚Ä¢ Feito para performance e convers√£o.</small>
    </div>
  </footer>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
  
  <script>
  const SUPABASE_URL = "https://dwqkuwqmlhvplmgwksas.supabase.co";
  const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR3cWt1d3FtbGh2cGxtZ3drc2FzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3ODM4NjksImV4cCI6MjA3MDM1OTg2OX0._pFblnBzx5cf0SUfAC_w-kmcdFbidZsh23XKXJR98ng";
  const supabase = (window.supabase && SUPABASE_URL) ? window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY) : null;

  const $ = (id) => document.getElementById(id);
  const pad5 = (n) => String(n).padStart(5, "0"); // << cinco d√≠gitos

  const thresholds = [
    { p: 50,  label: "10% OFF pr√≥xima compra" },
    { p: 100, label: "Camiseta b√°sica Vita Septem" },
    { p: 150, label: "Polo ou cal√ßa social 20% OFF" },
    { p: 200, label: "Camisa social premium" },
    { p: 300, label: "Vale-compras R$ 200,00" },
  ];

  const ui = {
    loginForm: $('formLogin'),
    cadForm:   $('formCadastro'),
    loginMsg:  $('loginMsg'),
    cadMsg:    $('cadMsg'),
    painel:    $('painel'),
    uNome:     $('uNome'),
    uCard:     $('uCard'),
    uStatus:   $('uStatus'),
    uPontos:   $('uPontos'),
    bar:       $('bar'),
    uMensagem: $('uMensagem'),
    tRewards:  $('tRewards'),
    btnSair:   $('btnSair'),
    btnCardQR: $('btnCardQR'),
    qrBox:     $('qrBox'),
  };

  let currentUser = null;
  let currentMember = null;

  function setInfo(el, msg, tone=""){ if(!el) return; el.textContent = msg || ""; el.style.color = tone==="error"?"#ff8080": tone==="ok"?"#a2f3c9":"#cfcfd6"; }

  // <<< agora valida 1..32767
  function validateMemberNo(raw){
    const n = parseInt(String(raw).replace(/\D/g,""), 10);
    if (isNaN(n)) return {ok:false, reason:"Informe um n√∫mero entre 1 e 32767"};
    if (n<1 || n>32767) return {ok:false, reason:"O n√∫mero deve ser de 01 at√© 32767"};
    return {ok:true, value:n};
  }

  function rewardRows(points){
    return thresholds.map(t=>{
      const ok = points >= t.p;
      const cls = ok ? "ok" : (points >= Math.max(0, t.p-25) ? "warn" : "danger");
      const status = ok ? "Dispon√≠vel para resgate" : `Faltam ${t.p - points} pts`;
      return `<tr><td>${t.p}</td><td>${t.label}</td><td class="${cls}">${status}</td></tr>`;
    }).join("");
  }

  function progressMsg(points){
    const next = thresholds.find(t=> points < t.p);
    if (!next) return "Voc√™ atingiu a faixa m√°xima de recompensas! üôå";
    const falta = next.p - points;
    return `Faltam ${falta} ponto(s) para ${next.label}.`;
  }

  function updateUIWithMember(m){
    currentMember = m;
    ui.uNome.textContent = m.name || "Cliente";
    ui.uCard.textContent = pad5(m.member_no);   // <<< mostra com 5 d√≠gitos
    ui.uStatus.textContent = m.is_vip ? "VIP" : "Cliente";
    const pts = m.points ?? 0;
    ui.uPontos.textContent = pts;

    const next = thresholds.find(t=> pts < t.p) || thresholds[thresholds.length-1];
    const denom = next ? next.p : 300;
    ui.bar.style.width = Math.max(0, Math.min(100, Math.round((pts/denom)*100))) + "%";

    ui.uMensagem.textContent = progressMsg(pts);
    ui.tRewards.innerHTML = rewardRows(pts);
    ui.painel.style.display = "block";
    if(location.hash !== '#painel') location.hash = '#painel';
  }

  function hidePainel(){
    ui.painel.style.display = "none";
    ui.tRewards.innerHTML = "";
    if (ui.qrBox){ ui.qrBox.style.display = "none"; ui.qrBox.innerHTML = ""; }
  }

  async function loadSession(){
    if(!supabase) return;
    const { data: { session } } = await supabase.auth.getSession();
    if(session?.user){ currentUser = session.user; await loadMemberProfile(); }
    else { currentUser = null; hidePainel(); }
  }

  async function loadMemberProfile(){
    if(!supabase || !currentUser) return;
    const { data, error } = await supabase
      .from('members')
      .select('id,name,phone,member_no,points,is_vip,created_at')
      .eq('id', currentUser.id)
      .maybeSingle();

    if(error){ console.error(error); hidePainel(); return; }
    if(!data){ await supabase.auth.signOut(); hidePainel(); return; }
    updateUIWithMember(data);
  }

  ui.loginForm?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    setInfo(ui.loginMsg, "Entrando...");
    const email = $('loginEmail').value.trim();
    const password = $('loginPass').value.trim();
    const { data, error } = await supabase.auth.signInWithPassword({ email, password });
    if(error){ setInfo(ui.loginMsg, "E-mail ou senha inv√°lidos.", "error"); return; }
    setInfo(ui.loginMsg, "Login realizado.", "ok");
    currentUser = data.user;
    await loadMemberProfile();
  });

  ui.cadForm?.addEventListener('submit', async (e)=>{
    e.preventDefault();
    setInfo(ui.cadMsg, "Cadastrando...");
    const name = $('cadNome').value.trim();
    const phone = $('cadTelefone').value.trim();
    const email = $('cadEmail').value.trim();
    const password = $('cadPass').value.trim();
    const rawNo = $('cadMemberNo').value.trim();

    if(!name || !email || !password){ setInfo(ui.cadMsg, "Preencha nome, e-mail e senha.", "error"); return; }

    const v = validateMemberNo(rawNo);
    if(!v.ok){ setInfo(ui.cadMsg, v.reason, "error"); return; }
    const member_no = v.value;

    const { data:sign, error:signErr } = await supabase.auth.signUp({ email, password });
    if(signErr){
      setInfo(ui.cadMsg, signErr.message?.includes("User already registered") ? "Este e-mail j√° est√° cadastrado." : "Erro ao criar conta.", "error");
      return;
    }

    const userId = sign.user?.id;
    if(!userId){ setInfo(ui.cadMsg, "Conta criada. Verifique seu e-mail para confirmar e depois fa√ßa login.", "ok"); return; }

    const { error:insErr } = await supabase.from('members').insert([{ id:userId, name, phone:phone||null, member_no, points:0, is_vip:false }]);
    if(insErr){
      if(String(insErr.code) === "23505"){ setInfo(ui.cadMsg, "Este n√∫mero de cart√£o j√° est√° em uso. Escolha outro entre 01 e 32767.", "error"); }
      else if(String(insErr.code) === "23514"){ setInfo(ui.cadMsg, "N√∫mero fora do intervalo permitido (01‚Äì32767).", "error"); }
      else { setInfo(ui.cadMsg, "N√£o foi poss√≠vel finalizar o cadastro.", "error"); }
      return;
    }

    setInfo(ui.cadMsg, "Conta criada com sucesso!", "ok");
    await loadSession();
  });

  ui.btnSair?.addEventListener('click', async ()=>{
    await supabase.auth.signOut();
    currentUser = null;
    hidePainel();
    location.hash = '#acesso';
  });

  // QR com 5 d√≠gitos no par√¢metro mn
  ui.btnCardQR?.addEventListener('click', ()=>{
    if(!currentMember) return;
    const url = `${location.origin}${location.pathname}?mn=${pad5(currentMember.member_no)}#acesso`;
    if(!ui.qrBox){ alert('Elemento #qrBox n√£o encontrado.'); return; }
    ui.qrBox.style.display = 'block';
    ui.qrBox.innerHTML = '';
    const canvas = document.createElement('canvas');
    canvas.width = canvas.height = 180;
    ui.qrBox.appendChild(canvas);
    if(window.QRCode && typeof window.QRCode.toCanvas === 'function'){
      window.QRCode.toCanvas(canvas, url, { width: 180 }, err => { if(err) console.error(err); });
    } else {
      ui.qrBox.innerHTML = '<small style="color:#900">Biblioteca de QRCode n√£o carregada.</small>';
    }
  });

  // prefill aceita at√© 5 d√≠gitos
  (function prefill(){
    const params = new URLSearchParams(location.search);
    const mn = params.get("mn");
    if(mn){
      const el = $('cadMemberNo');
      if (el) el.value = mn.replace(/\D/g,"").slice(0,5);
    }
  })();

  $('year').textContent = new Date().getFullYear();
  loadSession();
</script>

</body>

</html>





<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>Configurações & Integrações | Vita Septem</title>
  <link rel="icon" href="/assets/logo-mark.svg">
  <link rel="stylesheet" href="/css/theme.css">
  <script>
    window.ENV = window.ENV || {
      SUPABASE_URL:"https://dwqkuwqmlhvplmgwksas.supabase.co",
      SUPABASE_ANON_KEY:"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR3cWt1d3FtbGh2cGxtZ3drc2FzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3ODM4NjksImV4cCI6MjA3MDM1OTg2OX0._pFblnBzx5cf0SUfAC_w-kmcdFbidZsh23XKXJR98ng"
    };
  </script>
  <script type="module" src="/js/main.js"></script>
</head>
<body>
  <div id="app"></div>
  <div id="toasts"></div>

  <script type="module">
    import { requireAuth, assertRole } from "/js/lib/auth.js";
    import { mountLayout } from "/js/lib/layout.js";
    import "/js/modules/settings.js";

    const session = await requireAuth();
    if (!session) return;
    assertRole(["admin","manager"]);

    mountLayout("settings");
    document.getElementById("pageContent").innerHTML = `
      <h1 class="section-title" style="margin-top:6px">Configurações & Integrações</h1>

      <div class="grid cols-2">
        <div class="card">
          <div class="small">GTM & GA4</div>
          <div class="form-row">
            <div class="col-6"><label>GTM Container ID</label><input id="gtm_id" class="input" placeholder="GTM-XXXXXXX"></div>
            <div class="col-6"><label>GA4 Measurement ID (G-XXXX)</label><input id="ga4_id" class="input"></div>
          </div>
          <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px">
            <button class="btn" id="btnSaveGA">Salvar</button>
            <button class="btn ghost" id="btnTestGA">Testar</button>
          </div>
        </div>

        <div class="card">
          <div class="small">Meta Pixel</div>
          <div class="form-row">
            <div class="col-6"><label>Pixel ID</label><input id="pixel_id" class="input" placeholder="1234567890"></div>
            <div class="col-6"><label>Advanced Matching (hash por e-mail)</label><select id="pixel_match" class="input"><option value="true">Ligado</option><option value="false">Desligado</option></select></div>
          </div>
          <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px">
            <button class="btn" id="btnSavePixel">Salvar</button>
            <button class="btn ghost" id="btnTestPixel">Testar</button>
          </div>
        </div>

        <div class="card">
          <div class="small">Stripe</div>
          <p class="muted">Chaves secretas ficam no servidor (/api). Aqui você só ativa/desativa e vê logs.</p>
          <div style="display:flex; gap:8px; justify-content:flex-end">
            <button class="btn" id="btnStripeConnect">Conectar</button>
            <button class="btn ghost" id="btnStripeLogs">Ver Logs</button>
          </div>
        </div>

        <div class="card">
          <div class="small">PIX (PSP)</div>
          <p class="muted">As credenciais e callback são configuradas no servidor.</p>
          <div style="display:flex; gap:8px; justify-content:flex-end">
            <button class="btn" id="btnPixConnect">Conectar</button>
            <button class="btn ghost" id="btnPixTest">Testar cobrança</button>
          </div>
        </div>

        <div class="card">
          <div class="small">Consentimento (LGPD)</div>
          <div class="form-row">
            <div class="col-6"><label>Banner ativo</label><select id="consent_on" class="input"><option value="true">Sim</option><option value="false">Não</option></select></div>
            <div class="col-6"><label>Texto do banner</label><input id="consent_text" class="input" placeholder="Usamos cookies para melhorar sua experiência..."></div>
          </div>
          <div style="display:flex; gap:8px; justify-content:flex-end; margin-top:8px">
            <button class="btn" id="btnConsentSave">Salvar</button>
            <button class="btn ghost" id="btnConsentPreview">Pré-visualizar</button>
          </div>
        </div>
      </div>
    `;
    window.VS_SETTINGS.init();
  </script>
</body>
</html>

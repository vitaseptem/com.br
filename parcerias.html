<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vita Septem – Parcerias (Influenciadores & Afiliados)</title>
  <meta name="description" content="Programa de influenciadores e afiliados da Vita Septem. Comissões, benefícios, inscrição, materiais e calculadora de ganhos." />
  <meta name="theme-color" content="#880c21" />
  <!-- Open Graph -->
  <meta property="og:title" content="Vita Septem – Parcerias" />
  <meta property="og:description" content="Ganhe comissões indicando moda masculina elegante. Inscreva-se." />
  <meta property="og:type" content="website" />
  <meta property="og:image" content="icon.png" />
  <meta property="og:locale" content="pt_BR" />
  <!-- Fonts & Favicon -->
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600;700&family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <link rel="icon" type="image/x-icon" href="icon.ico">

  <style>
    :root{
      --wine:#880c21; --wine-600:#a11837;
      --black:#0e0e0f; --gray-900:#17171a; --gray-800:#1c1c20; --gray-700:#232327; --gray-600:#34343a; --gray-500:#8c8c94; --muted:#cfcfd6;
      --white:#ffffff; --radius:18px; --shadow:0 10px 30px rgba(0,0,0,.35); --success:#25D366; --warning:#f59e0b;
    }
    *{box-sizing:border-box}
    html{scroll-behavior:smooth}
    body{
      margin:0; font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--white); background:linear-gradient(180deg,var(--black),var(--gray-900) 35%, #0b0b0c);
      -webkit-font-smoothing:antialiased; text-rendering:optimizeLegibility;
    }
    a{color:inherit; text-decoration:none}
    .container{max-width:1200px; margin:0 auto; padding:0 20px}

    /* Header */
    header{position:sticky; top:0; z-index:80; backdrop-filter:saturate(140%) blur(8px);
      background:rgba(13,13,15,.7); border-bottom:1px solid rgba(255,255,255,.06)}
    .nav{display:flex; align-items:center; justify-content:center; padding:18px 0}
    .brand{display:flex; align-items:center; gap:12px}
    .brand img{height:110px; width:auto; object-fit:contain}

    /* Hero */
    .hero{position:relative; overflow:hidden; isolation:isolate}
    .hero::before{
      content:""; position:absolute; inset:-20%;
      background:radial-gradient(80% 60% at 70% 20%, rgba(136,12,33,.35), transparent 60%),
                 radial-gradient(60% 40% at 10% 10%, rgba(255,255,255,.08), transparent 60%);
      z-index:-1; filter:blur(10px)
    }
    .hero-grid{display:grid; grid-template-columns:1.1fr .9fr; gap:36px; align-items:center; padding:64px 0}
    .kicker{color:#e9e9ea; letter-spacing:.14em; text-transform:uppercase; font-size:.82rem}
    h1{margin:.35rem 0 1rem; font-family:"Playfair Display",serif; font-weight:700;
       font-size:clamp(2.1rem, 3.2vw + 1rem, 3.6rem); line-height:1.05;}
    .lead{color:#d9d9dd; font-size:1.05rem; max-width:52ch}
    .btn{display:inline-flex; align-items:center; gap:10px; padding:12px 18px; border-radius:14px; font-weight:600;
         background:var(--wine); border:1px solid rgba(255,255,255,.1); box-shadow:var(--shadow);
         transition:transform .15s ease, background .2s ease;}
    .btn:hover{background:var(--wine-600); transform:translateY(-1px)}
    .btn.secondary{background:transparent; border-color:rgba(255,255,255,.18)}
    .btn.ghost{background:#1a1a1e; border:1px solid rgba(255,255,255,.12)}

    .hero-visual{background:linear-gradient(180deg,#141416,#0d0d0f);
      border:1px solid rgba(255,255,255,.08); border-radius:var(--radius); min-height:360px;
      display:grid; place-items:center; position:relative; overflow:hidden}
    .hero-visual img{width:100%; height:100%; object-fit:cover}
    .tag{position:absolute; top:14px; right:14px; padding:6px 10px; border-radius:999px;
      background:rgba(136,12,33,.18); border:1px solid rgba(136,12,33,.5); font-size:.78rem}

    /* Sections */
    section{padding:56px 0}
    .section-title{font-family:"Playfair Display",serif; font-weight:700; font-size:2rem; margin:0 0 14px}
    .muted{color:var(--muted); margin:0 0 26px}
    .grid{display:grid; gap:18px; grid-template-columns:repeat(12,1fr)}

    /* Cards & Panels */
    .panel{background:linear-gradient(180deg,#141416,#101013); border:1px solid rgba(255,255,255,.08);
      border-radius:18px; padding:18px}
    .card{grid-column:span 4; background:linear-gradient(180deg,#141416,#101013);
      border:1px solid rgba(255,255,255,.08); border-radius:16px; overflow:hidden; transition:transform .15s ease;}
    .card:hover{transform:translateY(-3px)}
    .card .p{padding:14px}
    .badge{background:rgba(136,12,33,.22); border:1px solid rgba(136,12,33,.55); padding:4px 10px; border-radius:999px; font-size:.78rem}

    /* Tiers table */
    .tiers{width:100%; border-collapse:separate; border-spacing:0 8px}
    .tiers th, .tiers td{padding:12px 14px; text-align:left}
    .tiers thead th{font-weight:700; color:#fff; border-bottom:1px solid rgba(255,255,255,.12)}
    .rowline{background:#121214; border:1px solid rgba(255,255,255,.12); border-radius:12px}

    /* Inputs/Form */
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px}
    .row3{display:grid; grid-template-columns:1fr 1fr 1fr; gap:10px}
    .row4{display:grid; grid-template-columns:repeat(4,1fr); gap:10px}
    input, select, textarea{
      width:100%; padding:10px 12px; border-radius:12px; background:#121214; color:#fff;
      border:1px solid rgba(255,255,255,.12)
    }
    textarea{min-height:110px}
    .help{font-size:.9rem; color:#cfcfd6}
    .hint{font-size:.85rem; color:#bdbdc5}
    .alert{margin-top:10px; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.12); display:none}
    .alert.ok{display:block; background:rgba(48,209,88,.1); border-color:rgba(48,209,88,.4)}
    .alert.err{display:block; background:rgba(255,69,58,.10); border-color:rgba(255,69,58,.45)}
    .switch{display:flex; align-items:center; gap:8px; cursor:pointer}

    /* Gallery of resources */
    .res-grid{display:grid; grid-template-columns:repeat(4,1fr); gap:12px}
    .res{background:#121214; border:1px solid rgba(255,255,255,.12); border-radius:12px; overflow:hidden}
    .res .ph{height:140px; display:grid; place-items:center; background:#0f0f11}
    .res .ph img{max-width:90%; max-height:120px; object-fit:contain}
    .res .p{padding:12px}
    .res .actions{display:flex; gap:8px; margin-top:8px; flex-wrap:wrap}

    /* FAQ */
    details.faq{background:linear-gradient(180deg,#141416,#101013); border:1px solid rgba(255,255,255,.08);
      border-radius:16px; padding:14px 16px}
    details.faq:not(:last-child){margin-bottom:12px}
    details.faq summary{cursor:pointer; font-weight:600}

    /* Testimonials */
    .testi{display:grid; grid-template-columns:repeat(3,1fr); gap:18px}
    .quote{background:linear-gradient(180deg,#141416,#101013); border:1px solid rgba(255,255,255,.08);
      border-radius:16px; padding:18px; color:#e7e7ea}
    .quote b{display:block; margin-top:10px; color:#fff}
    .stars{letter-spacing:2px}

    /* WhatsApp FAB */
    .fab{position:fixed; right:18px; bottom:18px; background:var(--success); color:#000; font-weight:700;
      padding:12px 14px; border-radius:999px; box-shadow:var(--shadow); z-index:130}

    /* Footer */
    footer{border-top:1px solid rgba(255,255,255,.08); padding:28px 0 60px; color:var(--muted)}
    .brand-small{display:flex; gap:10px; align-items:center}
    .brand-small img{width:28px; height:28px}

    /* Responsive */
    @media (max-width: 980px){
      .hero-grid{grid-template-columns:1fr; padding:44px 0}
      .grid .card{grid-column:span 6}
      .res-grid{grid-template-columns:1fr 1fr}
      .testi{grid-template-columns:1fr}
      .brand img{height:76px}
      .row3{grid-template-columns:1fr}
      .row4{grid-template-columns:1fr 1fr}
    }
    @media (max-width: 640px){
      .grid .card{grid-column:span 12}
      .res-grid{grid-template-columns:1fr}
      .brand img{height:64px}
      .row{grid-template-columns:1fr}
      .row4{grid-template-columns:1fr}
    }
  </style>
</head>
<body>
  <!-- FAB WhatsApp -->
  <a href="https://wa.me/5599981543912?text=Tenho%20interesse%20no%20programa%20de%20parcerias%20Vita%20Septem" class="fab" aria-label="Falar no WhatsApp">WhatsApp</a>

  <!-- Header -->
  <header>
    <div class="container nav">
      <a class="brand" href="index.html#hero" aria-label="Ir para o início">
        <img src="icon2.png" alt="Logo Vita Septem">
      </a>
    </div>
  </header>

  <!-- HERO -->
  <section id="hero" class="hero" aria-label="Programa de Parcerias">
    <div class="container hero-grid">
      <div>
        <div class="kicker" id="heroBadge">Parcerias</div>
        <h1 id="heroTitle">Ganhe comissões indicando elegância.</h1>
        <p class="lead" id="heroLead">Se você cria conteúdo com propósito — lifestyle, moda masculina, culto, trabalho — nosso programa é para você.</p>
        <div style="display:flex; gap:12px; flex-wrap:wrap; margin-top:22px">
          <a href="#beneficios" class="btn">Ver benefícios</a>
          <a href="#inscricao" class="btn secondary">Inscreva-se agora</a>
        </div>
      </div>
      <div class="hero-visual" role="img" aria-label="Influenciadores & Afiliados">
        <span class="tag" id="heroTag">Comissão até 15%</span>
        <img id="heroImg" src="https://images.unsplash.com/photo-1515378791036-0648a3ef77b2?q=80&w=1600&auto=format&fit=crop" alt="Programa de Parcerias – Vita Septem">
      </div>
    </div>
  </section>

  <!-- BENEFÍCIOS -->
  <section id="beneficios" aria-labelledby="ttl-benef">
    <div class="container">
      <h2 class="section-title" id="ttl-benef">Benefícios do Programa</h2>
      <p class="muted">Comissões, materiais prontos, cupons exclusivos e suporte.</p>
      <div class="grid" id="benefGrid">
        <!-- via Supabase; fallback abaixo -->
      </div>
    </div>
  </section>

  <!-- NÍVEIS DO PROGRAMA -->
  <section id="niveis" aria-labelledby="ttl-niveis">
    <div class="container">
      <h2 class="section-title" id="ttl-niveis">Níveis & Comissões</h2>
      <p class="muted" id="tiersLead">Cresça com a gente. Quanto mais resultado, maior a comissão.</p>
      <div class="panel" style="overflow:auto">
        <table class="tiers" aria-describedby="tiersLead">
          <thead>
            <tr>
              <th>Nível</th>
              <th>Critério</th>
              <th>Comissão</th>
              <th>Cookie</th>
              <th>Mínimo de saque</th>
            </tr>
          </thead>
          <tbody id="tiersBody">
            <!-- linhas via Supabase -->
          </tbody>
        </table>
      </div>
    </div>
  </section>

  <!-- CALCULADORA DE GANHOS -->
  <section id="calc" aria-labelledby="ttl-calc">
    <div class="container">
      <h2 class="section-title" id="ttl-calc">Calculadora de ganhos</h2>
      <p class="muted">Simule ganhos mensais pela sua audiência.</p>
      <div class="panel">
        <div class="row4">
          <div>
            <label class="hint">Ticket médio (R$)</label>
            <input id="cAov" type="number" min="0" step="10" value="150">
          </div>
          <div>
            <label class="hint">Taxa de conversão (%)</label>
            <input id="cCv" type="number" min="0" step="0.1" value="2.0">
          </div>
          <div>
            <label class="hint">Cliques/mês</label>
            <input id="cClicks" type="number" min="0" step="50" value="1000">
          </div>
          <div>
            <label class="hint">Comissão (%)</label>
            <input id="cRate" type="number" min="1" max="25" step="0.5" value="10">
          </div>
        </div>
        <div class="row" style="margin-top:12px">
          <div class="panel" style="background:#121214">
            <div class="hint">Vendas estimadas</div>
            <div id="cOrders" style="font-size:1.6rem; font-weight:700">0</div>
          </div>
          <div class="panel" style="background:#121214">
            <div class="hint">Ganhos estimados</div>
            <div id="cRevenue" style="font-size:1.6rem; font-weight:700">R$ 0,00</div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- CONSTRUTOR DE LINK -->
  <section id="link" aria-labelledby="ttl-link">
    <div class="container">
      <h2 class="section-title" id="ttl-link">Seu link de indicação</h2>
      <p class="muted">Escolha seu identificador (handle) e gere o link com UTM para copiar.</p>
      <div class="panel">
        <div class="row">
          <div>
            <label class="hint">Seu @handle (sem @)</label>
            <input id="hHandle" type="text" placeholder="seunome">
          </div>
          <div>
            <label class="hint">Campanha/utm_campaign (opcional)</label>
            <input id="hCamp" type="text" placeholder="bf-2026">
          </div>
        </div>
        <div class="row" style="margin-top:10px">
          <div>
            <label class="hint">Link final</label>
            <input id="hLink" type="text" readonly>
            <div class="help">Padrão: <code>index.html?ref=HANDLE&utm_source=partner&utm_medium=link&utm_campaign=...</code></div>
          </div>
          <div style="display:flex; gap:10px; align-items:flex-end">
            <button class="btn" id="hCopy">Copiar link</button>
            <button class="btn ghost" id="hTest">Abrir em nova aba</button>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- MATERIAIS DE DIVULGAÇÃO -->
  <section id="materiais" aria-labelledby="ttl-mat">
    <div class="container">
      <h2 class="section-title" id="ttl-mat">Materiais para baixar</h2>
      <p class="muted">Logos, banners e mockups para seus posts. Atualizamos periodicamente.</p>
      <div class="res-grid" id="resGrid"></div>
      <div class="muted" id="resEmpty" style="display:none">Sem materiais por enquanto.</div>
    </div>
  </section>

  <!-- DEPOIMENTOS -->
  <section id="depo" aria-labelledby="ttl-depo">
    <div class="container">
      <h2 class="section-title" id="ttl-depo">Quem já trabalha com a gente</h2>
      <div class="testi" id="testiGrid"></div>
      <div class="muted" id="testiEmpty" style="display:none">Seja o primeiro a dar seu depoimento.</div>
    </div>
  </section>

  <!-- FAQ -->
  <section aria-labelledby="ttl-faq">
    <div class="container">
      <h2 class="section-title" id="ttl-faq">Perguntas frequentes</h2>
      <div id="faqList"></div>
    </div>
  </section>

  <!-- INSCRIÇÃO -->
  <section id="inscricao" aria-labelledby="ttl-insc">
    <div class="container">
      <h2 class="section-title" id="ttl-insc">Inscreva-se</h2>
      <p class="muted">Conte sobre você e onde publica. Retornamos por e-mail/WhatsApp.</p>
      <div class="panel">
        <div class="row">
          <input id="fName" type="text" placeholder="Seu nome completo *" autocomplete="name">
          <input id="fEmail" type="email" placeholder="E-mail *" autocomplete="email">
        </div>
        <div class="row">
          <input id="fPhone" type="tel" placeholder="WhatsApp (com DDD)" autocomplete="tel">
          <input id="fCity" type="text" placeholder="Cidade/Estado">
        </div>
        <div class="row3">
          <input id="fInsta" type="text" placeholder="Instagram (sem @)">
          <input id="fTiktok" type="text" placeholder="TikTok (sem @)">
          <input id="fYoutube" type="text" placeholder="YouTube canal (opcional)">
        </div>
        <div class="row">
          <select id="fFollowers">
            <option value="">Faixa de seguidores *</option>
            <option value="0-5k">0–5k</option>
            <option value="5k-20k">5k–20k</option>
            <option value="20k-100k">20k–100k</option>
            <option value="100k+">100k+</option>
          </select>
          <select id="fCategory">
            <option value="">Categoria principal *</option>
            <option>Moda masculina</option>
            <option>Gospel / Igreja</option>
            <option>Estilo de vida</option>
            <option>Trabalho & Negócios</option>
            <option>Fitness & Saúde</option>
            <option>Outros</option>
          </select>
        </div>
        <div>
          <textarea id="fNotes" placeholder="Fale sobre seu público, regiões, frequência de posts e cases (opcional)"></textarea>
        </div>

        <div class="row" style="align-items:center">
          <div>
            <label class="hint">Portfólio / Mídia kit (PDF/JPG/PNG, até 15MB)</label>
            <input id="fFile" type="file" accept=".pdf,.jpg,.jpeg,.png,.webp">
            <div class="help" id="fFileHint">Nada enviado ainda.</div>
          </div>
          <div style="align-self:flex-end">
            <button class="btn ghost" id="fUpload">Enviar arquivo</button>
          </div>
        </div>

        <!-- honeypot -->
        <input id="hpWebsite" type="text" style="display:none" autocomplete="off" tabindex="-1" aria-hidden="true">

        <label class="switch" style="margin-top:10px">
          <input id="fAgree" type="checkbox">
          <span>Concordo com os termos do programa e o uso dos meus dados para contato.</span>
        </label>
        <div class="alert" id="fAlert"></div>

        <div style="display:flex; gap:10px; flex-wrap:wrap; margin-top:12px">
          <button class="btn" id="fSubmit">Enviar inscrição</button>
          <a class="btn secondary" href="#link">Gerar meu link</a>
        </div>
        <p class="hint" id="progMeta">Cookie <b id="pmCookie">7</b> dias • Saque mínimo <b id="pmPayout">R$ 100,00</b> • Comissão base <b id="pmRate">10%</b></p>
      </div>
    </div>
  </section>

  <!-- CONTATO/LOCAL -->
  <section aria-label="Informações de contato e localização">
    <div class="container" style="display:grid; grid-template-columns:1.2fr .8fr; gap:22px">
      <div>
        <h3 class="section-title" style="margin-top:0">Visite a loja</h3>
        <p class="muted">Rua Nova, Centro – São João do Caru / MA<br/>Seg–Sáb: 9h às 19h</p>
        <div style="display:flex; gap:10px; flex-wrap:wrap">
          <a class="btn ghost" href="https://wa.me/5599981543912?text=Tenho%20interesse%20no%20programa%20de%20parcerias%20Vita%20Septem">WhatsApp</a>
          <a class="btn ghost" href="https://www.instagram.com/vitaseptem" target="_blank" rel="noopener">Instagram</a>
        </div>
      </div>
      <div aria-hidden="true">
        <iframe title="Mapa da loja" width="100%" height="220" style="border:0; border-radius:14px"
          loading="lazy" referrerpolicy="no-referrer-when-downgrade"
          src="https://www.google.com/maps?q=São%20João%20do%20Caru%20MA&output=embed"></iframe>
      </div>
    </div>
  </section>

  <footer>
    <div class="container" style="display:flex; align-items:center; justify-content:space-between; gap:16px; flex-wrap:wrap">
      <div class="brand-small">
        <img src="icon.png" alt="" aria-hidden="true">
        <span>© <span id="year"></span> Vita Septem – Men’s Fashion</span>
      </div>
      <small>Desenvolvido para performance e conversão.</small>
    </div>
  </footer>

  <!-- Supabase -->
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script>
    // ====== Config ======
    const SUPABASE_URL = "https://dwqkuwqmlhvplmgwksas.supabase.co";
    const SUPABASE_ANON_KEY = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR3cWt1d3FtbGh2cGxtZ3drc2FzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3ODM4NjksImV4cCI6MjA3MDM1OTg2OX0._pFblnBzx5cf0SUfAC_w-kmcdFbidZsh23XKXJR98ng";
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, { auth:{ persistSession:false }});

    const PROG_SLUG = "vita-septem";
    const BUCKET = "partners"; // bucket público para materiais e uploads de portfólio
    const WHATSAPP = "5599981543912";
    document.getElementById('year').textContent = new Date().getFullYear();

    // ===== Utils =====
    const $ = (id)=> document.getElementById(id);
    const params = new URLSearchParams(location.search);
    const incomingRef = params.get('ref') || "";
    if(incomingRef){
      localStorage.setItem('vs_ref', incomingRef);
    }
    function toBRL(v){ return Number(v||0).toLocaleString('pt-BR',{style:'currency',currency:'BRL'}); }
    function storageUrl(path){
      try{ const { data } = supabase.storage.from(BUCKET).getPublicUrl(path); return data.publicUrl || ""; }
      catch{ return ""; }
    }
    function imgUrlFrom(obj){
      if(!obj) return "";
      if(obj.url) return obj.url;
      if(obj.path) return storageUrl(obj.path);
      return "";
    }
    function slugify(s){ return (s||"").toString().normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^a-zA-Z0-9]+/g,'-').replace(/^-+|-+$/g,'').toLowerCase(); }
    function copy(text){
      try{ navigator.clipboard.writeText(text); return true; }catch{ return false; }
    }

    // ===== Hero dynamic (program meta) =====
    const heroImg = $('heroImg'), heroTitle=$('heroTitle'), heroLead=$('heroLead'), heroBadge=$('heroBadge'), heroTag=$('heroTag');

    // ===== Benefits =====
    const benefGrid = $('benefGrid');

    // ===== Tiers table =====
    const tiersBody = $('tiersBody');
    const pmCookie = $('pmCookie'), pmPayout = $('pmPayout'), pmRate = $('pmRate');

    // ===== Calculator =====
    const cAov=$('cAov'), cCv=$('cCv'), cClicks=$('cClicks'), cRate=$('cRate'), cOrders=$('cOrders'), cRevenue=$('cRevenue');
    function recalc(){
      const aov = Math.max(0, parseFloat(cAov.value||0));
      const cv  = Math.max(0, parseFloat(cCv.value||0))/100;
      const cl  = Math.max(0, parseInt(cClicks.value||0,10));
      const rate= Math.max(0, parseFloat(cRate.value||0))/100;
      const orders = Math.round(cl * cv);
      const revenue = orders * aov * rate;
      cOrders.textContent = orders.toString();
      cRevenue.textContent = toBRL(revenue);
    }
    [cAov,cCv,cClicks,cRate].forEach(el=> el.addEventListener('input', recalc));
    recalc();

    // ===== Link builder =====
    const hHandle=$('hHandle'), hCamp=$('hCamp'), hLink=$('hLink'), hCopy=$('hCopy'), hTest=$('hTest');
    function updateLink(){
      const handle = slugify(hHandle.value.trim());
      const camp = slugify(hCamp.value.trim());
      const base = (location.origin + location.pathname).replace(/\/[^\/]*$/,'/index.html');
      const qs = new URLSearchParams({ ref: handle || 'seuhandle', utm_source:'partner', utm_medium:'link' });
      if(camp) qs.set('utm_campaign', camp);
      hLink.value = `${base}?${qs.toString()}`;
    }
    [hHandle,hCamp].forEach(el=> el.addEventListener('input', updateLink));
    updateLink();
    hCopy.onclick = ()=> { copy(hLink.value); hCopy.textContent='Copiado!'; setTimeout(()=> hCopy.textContent='Copiar link', 1200); }
    hTest.onclick = ()=> { window.open(hLink.value, '_blank'); }

    // ===== Resources grid =====
    const resGrid = $('resGrid'), resEmpty = $('resEmpty');
    function resCard(r){
      const preview = r.thumb_url || (r.thumb_path ? storageUrl(r.thumb_path) : (r.url || storageUrl(r.path)));
      const fileUrl = r.url || (r.path ? storageUrl(r.path) : '');
      const ext = (r.filename||'').split('.').pop().toUpperCase();
      return `
        <div class="res">
          <div class="ph">${preview ? `<img src="${preview}" alt="${r.title||'Recurso'}">` : `<span class="hint">${ext||'ARQ'}</span>`}</div>
          <div class="p">
            <div style="display:flex; justify-content:space-between; align-items:center; gap:8px">
              <strong>${r.title||'Recurso'}</strong>
              ${r.badge? `<span class="badge">${r.badge}</span>`:''}
            </div>
            ${r.description? `<div class="hint" style="margin-top:6px">${r.description}</div>`:''}
            <div class="actions">
              ${fileUrl? `<a class="btn" href="${fileUrl}" download>Baixar</a>`:''}
              ${fileUrl? `<button class="btn ghost" onclick="navigator.clipboard.writeText('${fileUrl}'); this.textContent='Copiado'; setTimeout(()=>this.textContent='Copiar URL',1100)">Copiar URL</button>`:''}
            </div>
          </div>
        </div>
      `;
    }

    // ===== Testimonials & FAQ =====
    const testiGrid=$('testiGrid'), testiEmpty=$('testiEmpty');
    function testiCard(t){
      const stars = '★'.repeat(Math.max(3, Math.min(5, t.stars||5))) + '☆'.repeat(5-Math.max(3, Math.min(5, t.stars||5)));
      return `<div class="quote"><div class="stars">${stars}</div>“${t.quote||''}”<b>${t.author||'Parceiro'}</b></div>`;
    }
    const faqList=$('faqList');
    function faqItem(f){ return `<details class="faq"><summary>${f.q||'Pergunta'}</summary><div class="muted" style="margin-top:8px">${f.a||''}</div></details>`; }

    // ===== Application form =====
    const fName=$('fName'), fEmail=$('fEmail'), fPhone=$('fPhone'), fCity=$('fCity');
    const fInsta=$('fInsta'), fTiktok=$('fTiktok'), fYoutube=$('fYoutube');
    const fFollowers=$('fFollowers'), fCategory=$('fCategory'), fNotes=$('fNotes');
    const fFile=$('fFile'), fFileHint=$('fFileHint'), fUpload=$('fUpload');
    const fAgree=$('fAgree'), fAlert=$('fAlert'), fSubmit=$('fSubmit');
    const hpWebsite=$('hpWebsite');
    const progMeta=$('progMeta');

    let uploadedPath = ""; let uploadedUrl = "";
    fUpload.onclick = async ()=>{
      if(!fFile.files || !fFile.files[0]){ fFileHint.textContent='Selecione um arquivo primeiro.'; return; }
      const file = fFile.files[0];
      if(file.size > 15*1024*1024){ fFileHint.textContent='Arquivo acima de 15MB.'; return; }
      const safeName = slugify(fName.value || file.name.replace(/\.[^/.]+$/, ''));
      const key = `applications/${Date.now()}_${safeName}.${(file.name.split('.').pop()||'bin')}`;
      try{
        const { error } = await supabase.storage.from(BUCKET).upload(key, file, { upsert:false, cacheControl: '3600' });
        if(error) throw error;
        uploadedPath = key;
        uploadedUrl = storageUrl(key);
        fFileHint.textContent = `Enviado: ${key}`;
      }catch(err){
        console.warn('Upload falhou:', err?.message);
        fFileHint.textContent = 'Não foi possível enviar agora.';
      }
    };

    function validEmail(s){ return /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test((s||"").trim()); }
    function alertBox(ok,msg){ fAlert.className='alert '+(ok?'ok':'err'); fAlert.textContent=msg; }

    async function saveApplication(){
      const payload = {
        name: fName.value.trim(),
        email: fEmail.value.trim(),
        phone: fPhone.value.trim() || null,
        city: fCity.value.trim() || null,
        instagram: fInsta.value.trim() || null,
        tiktok: fTiktok.value.trim() || null,
        youtube: fYoutube.value.trim() || null,
        followers_range: fFollowers.value || null,
        category: fCategory.value || null,
        notes: fNotes.value || null,
        portfolio_path: uploadedPath || null,
        portfolio_url: uploadedUrl || null,
        ref_handle: hHandle.value.trim() || null,
        utm_campaign: hCamp.value.trim() || null,
        source: 'web',
        program_slug: PROG_SLUG
      };

      // tenta inserir na tabela dedicada; se falhar, faz fallback para leads
      try{
        const { error } = await supabase.from('partner_applications').insert([payload]);
        if(error) throw error;
        return true;
      }catch(err){
        console.warn('partner_applications indisponível, tentando leads:', err?.message);
        try{
          const { error } = await supabase.from('leads').insert([{
            name: payload.name,
            email: payload.email,
            phone: payload.phone,
            tag: 'partner_apply',
            launch_slug: payload.program_slug,
            source: `fallback|insta:${payload.instagram||''}|tiktok:${payload.tiktok||''}|yt:${payload.youtube||''}|fol:${payload.followers_range||''}|cat:${payload.category||''}|file:${payload.portfolio_url||payload.portfolio_path||''}|ref:${payload.ref_handle||''}|utm:${payload.utm_campaign||''}`
          }]);
          if(error) throw error;
          return true;
        }catch(err2){
          console.warn('leads insert também falhou:', err2?.message);
          return false;
        }
      }
    }

    fSubmit.onclick = async ()=>{
      if(hpWebsite.value){ return; } // honeypot
      if(!fName.value.trim()){ alertBox(false,'Informe seu nome.'); return; }
      if(!validEmail(fEmail.value)){ alertBox(false,'E-mail inválido.'); return; }
      if(!fFollowers.value){ alertBox(false,'Selecione a faixa de seguidores.'); return; }
      if(!fCategory.value){ alertBox(false,'Selecione a categoria.'); return; }
      if(!fAgree.checked){ alertBox(false,'Você precisa concordar com os termos.'); return; }
      fSubmit.disabled = true; fSubmit.textContent='Enviando...';

      const ok = await saveApplication();
      if(ok){
        alertBox(true,'Inscrição enviada com sucesso! Você receberá retorno em breve.');
        localStorage.setItem('vs_partner_applied','1');
        fSubmit.textContent='Enviado ✔'; setTimeout(()=> fSubmit.textContent='Enviar inscrição', 1600);
      }else{
        alertBox(false,'Não foi possível enviar agora. Tente novamente em instantes.');
        fSubmit.textContent='Tentar novamente';
      }
      fSubmit.disabled = false;
    };

    // ===== Render helpers =====
    function benefCard(b){
      return `
        <article class="card">
          <div class="p">
            <div style="display:flex; justify-content:space-between; align-items:center">
              <h3 style="margin:0">${b.title||'Benefício'}</h3>
              ${b.badge? `<span class="badge">${b.badge}</span>`:''}
            </div>
            ${b.description? `<p class="muted" style="margin:6px 0 0">${b.description}</p>`:''}
          </div>
        </article>
      `;
    }
    function tierRow(t, meta){
      const cookie = (t.cookie_days || meta.cookie_days || 7) + 'd';
      const payout = toBRL(t.payout_min_brl || meta.payout_min_brl || 10000/100);
      const rate = ((t.commission_pct ?? meta.commission_pct ?? 10)).toFixed(1).replace('.0','') + '%';
      return `<tr class="rowline"><td>${t.name||'Nível'}</td><td>${t.criteria||'-'}</td><td>${rate}</td><td>${cookie}</td><td>${payout}</td></tr>`;
    }

    // ===== Load program from Supabase (with fallback) =====
    async function loadProgram(){
      try{
        const { data, error } = await supabase
          .from('partner_program')
          .select(`
            id, slug, title, subtitle, badge, tag_text, hero_url, hero_path,
            commission_pct, cookie_days, payout_min_brl, is_active,
            partner_benefits ( title, description, badge, sort_order, is_active ),
            partner_tiers ( name, criteria, commission_pct, cookie_days, payout_min_brl, sort_order, is_active ),
            partner_resources ( title, description, badge, filename, url, path, thumb_url, thumb_path, sort_order, is_active ),
            partner_testimonials ( author, quote, stars, sort_order, is_active ),
            partner_faqs ( q, a, sort_order, is_active )
          `)
          .eq('slug', PROG_SLUG)
          .eq('is_active', true)
          .maybeSingle();
        if(error) throw error;

        if(!data){ applyFallback(); return; }

        // Hero/meta
        const hero = data.hero_url || (data.hero_path ? storageUrl(data.hero_path) : '');
        if(hero) heroImg.src = hero;
        if(data.title) heroTitle.textContent = data.title;
        if(data.subtitle) heroLead.textContent = data.subtitle;
        if(data.badge) heroBadge.textContent = data.badge;
        if(data.tag_text) heroTag.textContent = data.tag_text;

        // Meta defaults for calc & form hint
        const meta = {
          commission_pct: data.commission_pct ?? 10,
          cookie_days: data.cookie_days ?? 7,
          payout_min_brl: data.payout_min_brl ?? 10000
        };
        pmCookie.textContent = meta.cookie_days;
        pmPayout.textContent = toBRL((meta.payout_min_brl||0)/100);
        pmRate.textContent = ((meta.commission_pct||10)).toString()+'%';
        if(cRate.value === '10'){ cRate.value = meta.commission_pct; recalc(); }

        // Benefícios
        const benefits = (data.partner_benefits||[]).filter(x=>x.is_active!==false).sort((a,b)=>(a.sort_order||100)-(b.sort_order||100));
        benefits.forEach(b=> benefGrid.insertAdjacentHTML('beforeend', benefCard(b)));
        if(!benefits.length){ defaultBenefits(); }

        // Tiers
        const tiers = (data.partner_tiers||[]).filter(x=>x.is_active!==false).sort((a,b)=>(a.sort_order||100)-(b.sort_order||100));
        if(tiers.length){
          tiers.forEach(t=> tiersBody.insertAdjacentHTML('beforeend', tierRow(t, meta)));
        }else{
          defaultTiers(meta);
        }

        // Resources
        const res = (data.partner_resources||[]).filter(x=>x.is_active!==false).sort((a,b)=>(a.sort_order||100)-(b.sort_order||100));
        if(res.length){
          resGrid.innerHTML=''; res.forEach(r=> resGrid.insertAdjacentHTML('beforeend', resCard(r)));
          resEmpty.style.display='none';
        }else{
          resEmpty.style.display='block';
        }

        // Testimonials
        const ts = (data.partner_testimonials||[]).filter(x=>x.is_active!==false).sort((a,b)=>(a.sort_order||100)-(b.sort_order||100));
        if(ts.length){ ts.forEach(t=> testiGrid.insertAdjacentHTML('beforeend', testiCard(t))); testiEmpty.style.display='none'; }
        else{ testiEmpty.style.display='block'; }

        // FAQ
        const fq = (data.partner_faqs||[]).filter(x=>x.is_active!==false).sort((a,b)=>(a.sort_order||100)-(b.sort_order||100));
        if(fq.length){ fq.forEach(f=> faqList.insertAdjacentHTML('beforeend', faqItem(f))); }
        else{ defaultFaq(); }

      }catch(err){
        console.warn('Falha ao carregar partner_program:', err?.message);
        applyFallback();
      }
    }

    function defaultBenefits(){
      const defs = [
        { title:'Comissão justa', description:'Ganhe % sobre cada venda feita pelo seu link/cupom.' },
        { title:'Materiais prontos', description:'Logos, banners e mockups atualizados.' },
        { title:'Cupom exclusivo', description:'Seu público lembra de você e mede resultado.' },
        { title:'Suporte próximo', description:'Whatsapp direto para dúvidas e estratégia.' },
        { title:'Pagamentos pontuais', description:'Receba quando atingir o mínimo do programa.' },
        { title:'Parcerias longas', description:'Preferimos relações que crescem com o tempo.' }
      ];
      defs.forEach(b=> benefGrid.insertAdjacentHTML('beforeend', benefCard(b)));
    }
    function defaultTiers(meta){
      const tiers = [
        { name:'Inicial', criteria:'Indicação livre', commission_pct: meta.commission_pct, cookie_days: meta.cookie_days, payout_min_brl: meta.payout_min_brl },
        { name:'Intermediário', criteria:'10+ vendas/mês', commission_pct: (meta.commission_pct+2), cookie_days: meta.cookie_days, payout_min_brl: meta.payout_min_brl },
        { name:'Pro', criteria:'30+ vendas/mês', commission_pct: (meta.commission_pct+5), cookie_days: meta.cookie_days, payout_min_brl: meta.payout_min_brl }
      ];
      tiers.forEach(t=> tiersBody.insertAdjacentHTML('beforeend', tierRow(t, meta)));
    }
    function defaultFaq(){
      const fq = [
        { q:'Como sou aprovado?', a:'Após enviar sua inscrição, avaliamos alinhamento de conteúdo e respondemos por e-mail/WhatsApp.' },
        { q:'Como recebo?', a:'Pagamentos são feitos quando você atinge o mínimo do programa e fecha o período.' },
        { q:'Link ou cupom?', a:'Ambos. Use o link com UTM e um cupom exclusivo quando disponível.' },
        { q:'Quanto tempo o cookie dura?', a:'O padrão é 7 dias (pode mudar em campanhas específicas).' },
      ];
      fq.forEach(f=> faqList.insertAdjacentHTML('beforeend', faqItem(f)));
    }
    function applyFallback(){
      // hero
      heroTitle.textContent = 'Ganhe comissões indicando elegância.';
      heroLead.textContent = 'Parcerias transparentes, materiais prontos e suporte.';
      heroBadge.textContent = 'Parcerias';
      heroTag.textContent = 'Comissão até 15%';
      pmCookie.textContent = '7'; pmPayout.textContent = 'R$ 100,00'; pmRate.textContent = '10%';

      defaultBenefits();
      defaultTiers({ commission_pct:10, cookie_days:7, payout_min_brl:10000 });
      defaultFaq();

      // resources fallback vazio
      resEmpty.style.display='block';

      // depoimentos fallback
      const fb = [
        { author:'@estilo_leve', quote:'“Qualidade que combina com meu público.”', stars:5 },
        { author:'@vida_sobria', quote:'“Suporte rápido e comissões honestas.”', stars:5 }
      ];
      fb.forEach(t=> testiGrid.insertAdjacentHTML('beforeend', testiCard(t)));
    }

    // Boot
    loadProgram();

    // Preenche observações do cookie/payout em baixo do formulário quando o programa carregar
    // (já feito via pmCookie/pmPayout/pmRate)
  </script>
</body>
</html>

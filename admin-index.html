<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vita Septem – Acesso ao Dashboard</title>
  <meta name="theme-color" content="#880c21" />
  <link rel="icon" href="/assets/icon.svg">
  <link rel="stylesheet" href="/css/theme.css">
  <style>
    .login-wrap{
      min-height:100vh; display:grid; place-items:center;
      background:radial-gradient(60% 40% at 70% 20%, rgba(136,12,33,.35), transparent 60%),
                 radial-gradient(60% 40% at 20% 80%, rgba(255,255,255,.06), transparent 60%);
    }
    .login{
      width:min(560px, 92vw); background:linear-gradient(180deg,#141416,#101013);
      border:1px solid rgba(255,255,255,.08); border-radius:16px; overflow:hidden;
      box-shadow:var(--shadow)
    }
    .login .head{display:flex; align-items:center; justify-content:space-between; padding:16px; border-bottom:1px solid rgba(255,255,255,.06)}
    .login .body{padding:16px}
    .login .foot{padding:12px 16px; border-top:1px solid rgba(255,255,255,.06); display:flex; justify-content:space-between; align-items:center}
  </style>

  <!-- ENV pública para integrações (IDs apenas) -->
  <script>
    window.ENV = {
      SUPABASE_URL: "https://dwqkuwqmlhvplmgwksas.supabase.co",
      SUPABASE_ANON_KEY: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImR3cWt1d3FtbGh2cGxtZ3drc2FzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ3ODM4NjksImV4cCI6MjA3MDM1OTg2OX0._pFblnBzx5cf0SUfAC_w-kmcdFbidZsh23XKXJR98ng",
      GTM_ID: "",               /* opcional */
      GA4_MEASUREMENT_ID: "",   /* opcional */
      META_PIXEL_ID: ""         /* opcional */
    };
  </script>
  <script type="module" src="/js/main.js"></script>
</head>
<body>
  <div class="login-wrap">
    <div class="login" role="dialog" aria-label="Acesso ao dashboard">
      <div class="head">
        <div class="brand"><img src="/assets/icon2.svg" alt="" /><strong>Vita Septem</strong></div>
        <span class="badge">Dashboard</span>
      </div>
      <div class="body">
        <h1 class="section-title" style="margin:0 0 6px">Bem-vindo(a) ✦</h1>
        <p class="muted" style="margin:0 0 16px">Entre com seu e-mail e senha para acessar.</p>

        <form id="loginForm" novalidate>
          <div class="form-row">
            <div class="col-12">
              <label for="email">E-mail</label>
              <input class="input" id="email" type="email" required placeholder="voce@vitaseptem.com.br">
            </div>
          </div>
          <div class="form-row">
            <div class="col-12">
              <label for="password">Senha</label>
              <input class="input" id="password" type="password" required placeholder="••••••••">
            </div>
          </div>
          <div style="display:flex; gap:10px; align-items:center; justify-content:space-between; margin-top:8px">
            <button type="submit" class="btn" id="btnLogin">Entrar</button>
            <button type="button" class="btn secondary" id="btnRegister">Criar conta</button>
          </div>
        </form>

        <div style="margin-top:16px" class="small">
          Dica: você pode configurar **OAuth** (Google/Meta) depois em <b>Configurações → Integrações</b>.
        </div>
      </div>
      <div class="foot">
        <small class="muted">© <span id="year"></span> Vita Septem</small>
        <a class="badge" href="/dashboard.html">Entrar como demo</a>
      </div>
    </div>
  </div>

  <div id="toasts"></div>

  <script type="module">
    import { signInEmailPassword, signUpEmailPassword } from "/js/lib/auth.js";
    import { toast, setLoading } from "/js/lib/ui.js";

    document.getElementById("year").textContent = new Date().getFullYear();

    const form = document.getElementById("loginForm");
    const btnLogin = document.getElementById("btnLogin");
    const btnRegister = document.getElementById("btnRegister");

    form.addEventListener("submit", async (e)=>{
      e.preventDefault();
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      if(!email || !password){ toast("Preencha e-mail e senha.", "error"); return; }
      try{
        setLoading(btnLogin, true);
        await signInEmailPassword(email, password);
        toast("Login realizado com sucesso!", "success");
        window.location.href = "com.br/dashboard.html";
      }catch(err){
        console.error(err);
        toast(err.message || "Falha no login.", "error");
      }finally{
        setLoading(btnLogin, false);
      }
    });

    btnRegister.addEventListener("click", async ()=>{
      const email = document.getElementById("email").value.trim();
      const password = document.getElementById("password").value.trim();
      if(!email || !password){ toast("Digite e-mail e senha para criar.", "error"); return; }
      try{
        setLoading(btnRegister, true);
        await signUpEmailPassword(email, password, { name: email.split("@")[0] });
        toast("Conta criada! Verifique seu e-mail (se exigir) e faça login.", "success");
      }catch(err){
        console.error(err);
        toast(err.message || "Falha ao criar conta.", "error");
      }finally{
        setLoading(btnRegister, false);
      }
    });
  </script>
</body>
</html>

